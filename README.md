# fSEIR_simulator
SEIR epidemic spread simulator
https://medium.com/@jp.paiement13/predicting-covid-19-spread-via-airline-connections-fseir-and-testing-stemming-scenarios-75ac99dd3f97


Acknowledgements
This python workflow is based on the model developed by Nicholas A. Yager and Matthew Taylor in 2014 (https://github.com/nicholasyager/airport-disease-modeling).

Introduction
The onset of the Covid-19 pandemic opened the eyes of the world to the propagation risk of a virus through airports and travel routes. The world is hyper-connected, with travel from half way around the world a common occurrence. With viruses having the potential to seriously impact the human population and economics of the planet, predicting the routes for transmission becomes essential. This article explains how it is possible to build a platform that simulates and predicts the pandemic’s next move, as well as the impact of decisions by simulating different containment scenarios. These types of simulations, conducted early on during the developing pandemic, could help the world health authorities to construct and implement better policies in order to simulate a global effort to stop the spread of a virus.
This workflow (fSEIR) simulates the spread of a virus from a starting airport using demographic data combined with a random forest predictor in order to indicate which airport is likely be affected next. The model can then be used to test different stemming scenarios like flight cancellation and vaccination of different countries or cities.
Using the developed model, it is possible to see how differently the pandemic would have evolved if different flight cancellation strategies were employed at a global scale. Furthermore, it is also possible to see the effect of the introduction of a vaccine at different stages of the evolution of the pandemic.
This approach would also prove useful to generate scenarios for other emerging virus such as the common flu or Ebola.

Methodology
The general methodology of the model revolves around 1) developing a network using airports as nodes and airline routes as edges; and 2) predicting the spread of a virus using a directed graph approach. The NetworkX library in Python was used to build the network and Scikit Learn’s random forest regressor was used to model the pandemic evolution. The overall spreading approach uses the epidemic theory of the SEIR compartmentalized model (Herbert W. Hethcote, 2008), where nodes can either in one of four states: be susceptible to the virus(S), exposed(E); where they are in an incubation period, the node can be infected(I) or recovered(R). The python methodology developed by Yager et al., uses the weight of edges (calculate from in and out degrees) to simulate the spread of a virus through the network. In this novel modeling strategy, the distribution parameters were modified to use an edge weight based on the feature importance from a random forest regressor model in combination with the prior weighting estimation. The random forest prediction model uses demographic data from the different countries as prediction features of the current Covid-19 spread evolution for the first 100 days. The weights are then used to control how efficiently an infected node can expose other nodes in the network.
The different datasets used in this modelling effort are taken from:
1. https://www.ecdc.europa.eu/en/publications-data/download-todays-data-geographic-distribution-covid-19-cases-worldwide for the cumber of reported Covid-19 cases,
2. https://openflights.org/ for the airport locations and routes data and
3. https://data.worldbank.org/ for the demographic datasets.

Predictive modelling of the pandemic spreading
Demographic data from different countries were compiled in a python dataframe and distributed on the different airport locations. For each available country, the data includes: GDP, population density, health expectation, tourist arrivals, sanitary services, population above 65, population between 14–65, population under 14, percentage of males, urban population, population growth, tourist spending, CO2 emission and Chinese diaspora. The features were scaled and the learning targets were set using the reported case evolution country by country as of March 15, 2020. A random forest regressor model was built in order to predict the known evolution and then extrapolated to the remaining countries over a 200 day timeline. Each fSEIR simulation starts when the predictive model reaches a R2 above 0.5. The random forest model uses 150 trees with a maximum depth of 25. The relative importance of feature are then extracted from this predictive model and they are used to calculate the weights of each nodes in the network. The demographic data is also used in a clustering approach in order to group the different airport nodes into groups of similar demographic conditions. The clusters are estimated using a distance matrix and a final number of 15 clusters. These clusters can then be used in the weight calculation, via a demographic distance between countries. The demographic distance between groups of countries are therefore based on the similarity of living conditions. The clusters can also be used when applying different stemming approaches, by cancelling flights of similar countries and/or vaccinating the countries within the same clusters.

Building flight network and spreading routes
The data for the airports and different airline routes are used to generate a directed graph using NetworkX. This directed graph takes into account the connection directions between the nodes and allows the infected nodes to spread through the network. Each node has its location information and the previously calculated weights attached to them. The edges linking the nodes are taken from the flight routes database and are classified as being international or domestic connections. Finally, the network is filtered to keep only the largest networks, and removing unconnected smaller networks. As an option, it is also possible to remove edges from the international and/or domestic edges from the modelling approach.

Covid-19 spreading model
Once the flight network is constructed, the virus can be spread through the various nodes from a starting location. The first infected node in this case would be the airport of Wuhan, China. Several parameters, adapted from the SEIR approach, can be set in order to model the pandemic’s spread: 1) the beta value corresponds to the number of nodes that can be exposed from an infected node (contact rate); 2) the alpha value controls the time it takes for an exposed node to become infected (incubation) and 3) the gamma value indicates time required for an infected node to transition to the recovered category. At the start of the simulation (day 0) all nodes are set to “susceptible” and the epidemic starting location is set to “exposed”. The node then becomes infected after the delay set by the alpha value. Once a node becomes infected, the virus can be propagated through the network from a list of potential exposed nodes; comprising nodes with “in edges” coming from an infected location (victims). In order to spread the infection, a victim node is required to pass a random selection condition, where, if a random value from 0–1 is greater than the weight calculated from the “in” and “out” degree (for domestic flights) and from the predictive model feature importance (for international flights), the node is set as exposed. After the incubation period, the exposed node then becomes infected and can infect other nodes.
The first step in modelling the Covid-19 pandemic spread was to test different approaches to the predictive modelling and also different parameters in controlling the speed at which the virus spreads. The final decision was set to use the predictive model’s weights from the demographic data and beta, alpha and gamma values of 35, 27, 80; which in turn correspond to real SEIR value of:
alpha = 0.27;
beta = 3.5 and
gamma = 1.25.
Given these numbers, it is possible to estimate a R0 value of 2.8; which is in line with the different studies publish for the Covid-19 pandemic (https://www.ncbi.nlm.nih.gov/pubmed/32097725 and https://ipac-canada.org/coronavirus-resources.php).
A total of ten (10) simulations were run on the flight network (fSEIR) with results shown in the GIF figures below. The simulation are not taking any stemming effort in account; hence the faster spread of the virus compared to the true number of cases. However, the evolution of the curve from the simulations compared to the real case count was deemed acceptable. Since these represent plausible scenarios, each simulation by itself cannot be considered as the reality; but by analyzing the 10 or more simulations, it is possible to see some patterns emerge on how the pandemic spreads through the fSEIR.

Stemming scenarios (flattening the curve)
It is also impossible to fully contain these types of epidemics to the first infected location, and since no vaccines are currently available, the pandemic can only be stopped once collective immunity is reached. However, efforts can still be made in order to stem the spreading of virus and avoid the overcrowding of hospitals. Using the fSEIR, it is be possible to simulate what would of happened if: 1) flights would have been cancelled throughout the world starting February 27th 2020 ; 2) China would have cancelled all international flights at the onset of the pandemic and 3) Canada would have closed its borders on February 19th 2020.
Note that due to the lack of testing and chronic underestimation of active cases in most countries, the assumed number of cases can be shifted up, and dates shifted back to reflect reality.
The fSEIR has a built-in function that can be used to cancel different flights scenarios by removing edges from the graph at different stages of the virus spread. The cancellation efforts can also be set at different levels of commitments as a percentage. The edges to cancel can be removed using different approaches: 1) random; 2) demographic cluster proximity and 3) custom country lists.
The first tested approach uses a random selection of international and domestic flights at different efforts; which make 20%, 50%, 80% and 100% of all airport connections. The flight cancellation efforts were put in place on February 27th, 2020, just after the outbreak in Italy and before the outbreak in Spain. The effect on the fSEIR curve can be sees in the figure below. Only a global effort of 80% has an real effect on stemming the propagation of the pandemic, with 100% effort effectively stopping the propagation of Covid-19. Another worldwide flight cancellation policy was tested using the clustering approach of the nodes (below), which cancels flights in all the routes related to the country starting the pandemic. In this case, the flights cancellation efforts were started on March 12th, 2020, the same day that the WHO declared that the Covid-19 was a global pandemics. Again here, the simulation show that if a joint effort at cancelling at least 80% of the flights was made, the pandemics would have affected fewer people globally; furthermore it could have been stemmed late April. 
Another simulation was constructed in order to see the effect on the pandemic if China would have closed their borders early in the onset of their own epidemic (below). If all international flights out of China would have been cancelled as of February 9th, 2020, the pandemic would have had very little impact on the global network. Hence the pandemic could have been avoided, however, if only 60% of the flights out of China would have been cancelled instead, this would have resulted in a global impact; just delayed by a few weeks. This second scenario could have provided more time to the international community to prepare a global effort to containing the Covid-19 outbreak.
Lastly, a simulation was run to test the impact of a single country closing their borders to international travelers. In this cases, we are testing the impact of Canada cancelling 100% of their flights on February 19th, 2020 (below). It is seen through this simulation that only closing one country’s borders, even early on, would have little to no effect on the global scale of the pandemic.

Vaccination of the population
Mass vaccination of the population would also likely impact the spread of a virus. Here we will be simulating the impact of introducing a Covid-19 vaccine after 60 days from the onset of the Chinese epidemic. In this case, the result of 5 simulations shows that vaccinating the six most affected countries (Italy, Spain, United States of America, United Kingdom, Germany, France) as of February 29th, 2020 would have significantly impacted the global spread of the pandemic.

Conclusion
The models show that only a global joint effort could successfully stem the propagation of a pandemic like Covid-19. When individual countries close their borders, it only affects the speed at which the virus spreads, delaying the infection maximum peak. The obvious exception is China.
During the onset of the current Covid-19 pandemic, countries acted individually, putting different efforts in place in order to stem the propagation. However, we see from the fSEIR model that only joint worldwide efforts in shutting down the spreading routes can effectively stem the propagation of a pandemic.
This tool offers a quick and efficient way to model the spread of a virus from an epicenter and test scenarios of combinations of efforts to halt the spread. Applied at the onset of epidemics, these models could enable health authorities to develop better and more effective policies to stop the spread of the virus through air travel routes.
